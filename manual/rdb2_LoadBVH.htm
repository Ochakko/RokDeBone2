<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<meta name="GENERATOR" content="JustSystems Homepage Builder Version 16.0.1.0 for Windows">
<meta http-equiv="Content-Style-Type" content="text/css">
<TITLE></TITLE>
</HEAD>
<BODY>
<P><B><FONT size="+2">ＢＶＨファイルの読み込み方</FONT><BR>
</B><BR>
bvhファイルと、ボーンの入っていないbvhの大きさにマッチした形状データを持っている場合には、<BR>
ファイルメニューからbvh読み込みを実行するだけでＯＫです。<BR>
<BR>
ですが大抵の場合、そのようなＢＶＨにフィットした形状データは手元にないものと思います。<BR>
（特にmqoやrokの場合）<BR>
<BR>
そこで、このページでは形状データにＢＶＨにフィットするボーンを入れ、ＢＶＨのモーションを読み込む手順を書きます。<BR>
<BR>
おおまかなイメージとしては、<BR>
ＢＶＨのボーンデータを読み込み、ボーンの位置を調整した後、<BR>
ＢＶＨのモーション部分だけを読み込む、<BR>
という感じです。<BR>
<BR>
///////////////////////////////////////////////////////////////<BR>
<BR>
　　１，ボーンの入っていないmqo又は、rokをＲＤＢ２で読み込む<BR>
<BR>
　　　　<IMG src="jpegfiles/bvh/bvh0.png" width="696" height="327" border="0"><BR>
<BR>
　　　　ボーンの入っていないデータがない場合は、連番ＭＱＯ出力をしてボーンの無いmqoファイルを出力してください。<BR>
<BR>
　　　　<s><U>形状データは後ろ向き、つまりＺ軸方向を向いているようにしてください。</U><BR>
　　　　　　もし、前向きのデータしかない場合は編集メニューの「形状データを後ろ向きにする」を実行してください。</s><BR>
　　　　<br>
　　　　<font color="#800000">2016/04/12追記<br>
　　　　GitHubに2016/04/12にpushしたバージョンのRokDeBone2から、形状を後ろ向きにしないでもbvhを前向きデータに変換できるようになりました。<br>
　　　　前向きのモデルに対してそのままbvhを読み込めばOKです。</font><br>
<br>
　　　　<IMG src="jpegfiles/bvh/bvh1.png" width="582" height="407" border="0"><BR>
<BR>
　　　　<IMG src="jpegfiles/bvh/bvh2.png" width="443" height="322" border="0"><BR>
<BR>
　　２，モーションの読み込みでＢＶＨを読み込む。<BR>
　　　　<BR>
　　　　４〜８倍程度の倍率で読むと良いと思います。<BR>
<BR>
　　　　<IMG src="jpegfiles/bvh/bvh3.png" width="412" height="407" border="0"><BR>
<BR>
　　　　sig, mqoなどは読み込みを行うと古い形状データを削除した後に新たに読み込みますが<BR>
　　　　bvhの場合は古い形状が残ったまま、それに追加する形でbvhの読み込みが行われます。<BR>
<BR>
　　　　まっさらな状態から読み込みなおしたい場合は<BR>
　　　　編集メニューの「形状、モーションデータの全削除」を実行してからbvhを読み込んでください。<BR>
<BR>
　　　　bvhの読み込みを行うと、ＢＶＨのボーン情報とモーション情報が読み込まれます。<BR>
<BR>
　　　　<IMG src="jpegfiles/bvh/bvh4.png" width="701" height="592" border="0"><BR>
　　　　bvhを読み込むとまだ何も設定していないので、上図のように形状が歪んだりしますが気にしない。<BR>
<br>
　　　　<font color="#800000">2016/04/08追記<BR>
　　　　bvhを読み込んだら、bvhデータを初期姿勢にするためにモーションメニューの「編集中のモーションを削除」を実行してください。</font><br>
<br>
<br>
<BR>
　　３，ジョイントの位置を調整する<BR>
<BR>
　　　　bvhの読み込み直後のボーンのポーズを覚えてください。<BR>
　　　　５で必要になります。<BR>
<BR>
　　　　bvhのボーンの姿勢と形状の姿勢が異なると思いますので<BR>
　　　　形状の姿勢に合うようにボーンの位置を調整します。<BR>
<BR>
　　　　ボーンの位置を調整するには<BR>
　　　　ツールボタンの「位」ボタンを押し、ダイアログでモーションを削除するモードを選び<BR>
　　　　さらに出てきたダイアログで「ジョイント」ボタンを押します。<BR>
　　　　３D表示画面には面の他に線と点が表示されるモードになりますので<BR>
　　　　見にくい場合はツールボタンの「線」と「点」ボタンを押して選択解除します。<BR>
　　　　<IMG src="jpegfiles/bvh/bvh5.png" width="704" height="413" border="0"><BR>
<BR>
　　　　<IMG src="jpegfiles/bvh/bvh6.png" width="703" height="423" border="0"><BR>
<BR>
<BR>
<BR>
　　　　位置調整は３Dウインドウ上の○マークのマウスドラッグとダイアログでの数値指定に対応しています。<BR>
<BR>
　　　　<IMG src="jpegfiles/bvh/bvh7.png" width="414" height="325" border="0"><BR>
<BR>
　　　　<IMG src="jpegfiles/bvh/bvh8.png" width="417" height="320" border="0"><BR>
　　　　○をドラッグしてどんどん位置調整していく。<BR>
<BR>
　　　　<IMG src="jpegfiles/bvh/bvh9.png" width="420" height="284" border="0"><BR>
　　　　真後ろからの調整が済んだところ。<BR>
<BR>
　　　　<IMG src="jpegfiles/bvh/bvh10.png" width="581" height="388" border="0"><BR>
　　　　真後ろからが済んだら、真横からさらにZ座標を調整する。<BR>
　　　　Z座標は複数のボーンの位置を正確に合わせたいので<BR>
　　　　数値入力を使います。<BR>
　　　　ダイアログで数値入力モードが絶対値になっていることを確認し<BR>
　　　　３Dウインドウ上で動かしたい○を選択し、ダイアログのZ座標に数値を入力して「入力値の反映」ボタンを押します。<BR>
<BR>
　　　　<IMG src="jpegfiles/bvh/bvh11.png" width="569" height="324" border="0"><BR>
　　　　真横からの調整も終わり！<BR>
<BR>
　　　　位置調整が終わったらダイアログを閉じます。<BR>
　　　　影響度の再計算をするかの問いには「はい」を選びます。<BR>
<BR>
　　４，影響度の調整をする。<BR>
<BR>
　　　　マウスで３Dウインドウ上の○マークをマウスでドラッグして姿勢を変えてうまく動くかを確認します。<BR>
　　　　全てのボーンを動かしてみてください。異なるボーンを選択する場合は○マークをShift + 左クリックです。<BR>
<BR>
　　　　腕を動かした場合に髪の毛が動いてしまったり、左足を動かした場合に右足の一部まで動いてしまったりする場合が多いです。<BR>
　　　　これは自動計算のボーンの影響度の設定に問題があるためです。<BR>
　　　　その場合は影響度の設定をしてください。<BR>
<BR>
　　　　影響度の設定の仕方は、おちゃっこLABのトップページに「講座」というリンクがあるので、そこを読んでください。<BR>
<BR>
<BR>
　　５，初期姿勢を変更する。<BR>
<BR>
　　　　現在のポーズと、３で覚えたＢＶＨのボーンの初期ポーズが異なる場合には<BR>
　　　　初期ポーズを３で覚えておいたポーズに調整する必要があります。<BR>
<BR>
　　　　簡単です。<BR>
　　　　ツールボタンのＲボタンを押し、ＩＫでbvhと初期ポーズと同じポーズを作ったら、<BR>
　　　　編集メニューの「現在のポーズを初期姿勢にする」を実行してください。<BR>
<BR>
　　　　<IMG src="jpegfiles/bvh/bvh12.png" width="701" height="408" border="0"><BR>
<BR>
<BR>
　　　　ここまで出来たらsigファイルを保存してください。<BR>
<BR>
　　６，ＢＶＨのモーションだけを読み込む。<BR>
<BR>
　　　　ＢＶＨを<FONT color="#800080"><U>「モーション情報のみを読み込む」にチェックを入れて</U></FONT>読み込んでください。<BR>
　　　　<BR>
　　　　<IMG src="jpegfiles/bvh/bvh13.png" width="415" height="417" border="0"><BR>
<BR>
　　　　（同じ骨組の（名前と階層構造が同じ）bvhを複数読み込む場合は、この６の手順だけでOKです。）<BR>
<BR>
　　７、プレビューする<BR>
<BR>
　　　　<IMG src="jpegfiles/bvh/bvh14.png" width="704" height="595" border="0"><BR>
<BR>
　　　　読み込んだ直後はデフォルト状態で、０フレームから１００フレームまでのモーションしか再生できないようになっています。<BR>
　　　　モーション全体を再生できるように変更します。<BR>
　　　　まずモーションウインドウのtotalのところを見てください。598という数字が書いてありますね。<BR>
　　　　これは読み込んだモーションのフレーム数が５９８フレームだということを表しています。<BR>
　　　　モーションウインドウ右下の「表示幅」のところにこのフレーム数より大きな数を指定します。<BR>
　　　　そして「幅適用」ボタンを押します。<BR>
　　　　その上の「開始位置」が０になっていないときは０にして「位置適用」ボタンを押してください。<BR>
<BR>
　　　　あとは「プレビュー開始」ボタンを押せばもーしょんが再生されます。<BR>
<BR>
<BR>
　　　　　　　//////////////////////////////////////////////////////////////<BR>
<BR>
<FONT size="+2"><B>ワンポイント</B></FONT><BR>
　　<BR>
　　ＢＶＨの初期状態は手と足が近すぎる場合が多く、このポーズからボーン影響度の設定をすると、<BR>
　　影２の場合などかなり骨が折れます。<BR>
<BR>
　　もうちょっと、ましな状態から始めたい場合は<BR>
　　まず、大の字のポーズで影響度の調整をして<BR>
　　編集メニューで初期姿勢を変更するといいです。<BR>
<BR>
<BR>
　　途中で取り消せない間違った操作をしてしまった場合は<BR>
　　IK操作以外は基本的にはやり直しですが（IKはCtrl + Zでアンドゥできます）<BR>
　　RokDeBone2にはAutoSave機能もあります。<BR>
　　AutoSaveフォルダの中身を調べると作業途中のデータが見つかるかもしれません。<BR>
<BR>
　　まめにsigを保存したほうが確実ですが。<BR>
<BR>
注意<BR>
　　bvh読み込みの際に、RokDeBone2とbvhとの仕様の違いを吸収するために<BR>
　　一番親に原点のボーンを１つ追加します。<BR>
　　このボーンはbvhモーションの際に動きません。<BR>
　　このボーンが出っ張ったり伸びたりして見えますが不具合ではありません。<BR>
<BR>
<BR>
　　　///////////////////////////////////////////////////////////////////////<BR>
<BR>
<A href="rokdebone.htm">RokDeBone2のトップページに戻る</A><BR>
<BR>
<A href="index.htm">トップページに戻る</A><BR>
</P>
</BODY>
</HTML>