<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<META name="GENERATOR" content="IBM WebSphere Studio Homepage Builder Version 6.5.0.0 for Windows">
<META http-equiv="Content-Style-Type" content="text/css">
<TITLE></TITLE>
</HEAD>
<BODY>
<P><B><FONT size="+2">ボーン情報のテキスト入出力</FONT></B></P>
<P><BR>
形状データや、ボーン構造などを変更するたびに、<BR>
ボーンの設定を、最初からやりなおなさければならない問題を解消するために、<BR>
ボーン情報の入出力機能をつけました。<BR>
<BR>
<B>メインウインドウの、file　メニュー</B>から、出力、入力が出来ます。<BR>
<BR>
ボーン情報のファイルの拡張子は bon にしました。<BR>
ファイルのフォーマットは、2種類用意しました。<BR>
それぞれ、”<B>混合タイプ</B>”、”<B>セパレートタイプ</B>”　と呼ぶことにします。<BR>
<BR>
どちらのフォーマットにおいても、ジョイントのシリアル番号と、名前の情報を記述することになります。<BR>
<BR>
ジョイントのシリアル番号は、RokDeBone2で確認できます。<BR>
階層構造エディタの、”表示パラメータの設定”メニューを選択すると、<BR>
”Sig Params ダイアログ”が出てきます。<BR>
ダイアログの上から2行目に、serialno : として表示されます。<BR>
<BR>
また、ボーン情報の入っている（線分データの入っている）rok, mqo を読み込むんだときに、<BR>
ジョイントの名前に、シリアル番号が付けるようにしたので、一目で分かると思います。<BR>
<U>ただし、RokDeBone2 ver1.0.1.8以前のバージョンで読み込んだデータの名前に付いている番号は、<BR>
シリアル番号ではないので、注意してください。<BR>
</U><BR>
<BR>
<BR>
以下に、それぞれのフォーマットの説明を書きます。<BR>
</P>
<P><FONT size="+2"><B>混合タイプのフォーマット</B></FONT><BR>
<BR>
まず、混合タイプの出力例をご覧ください。<BR>
<BR>
----------- file のはじまり　------------------------<BR>
BoneFile : type <B>mixed</B> : ver1001<BR>
<BR>
0103:,0135:移動,0134:尻,0148:スカート前１,0147:スカート前２,0146:スカート前３,0145:スカート前４,<BR>
0134:,0149:スカート右前１,0152:スカート右前２,0151:スカート右前３,0150:スカート右前４,<BR>
0134:,0156:スカート右１,0155:スカート右２,0154:スカート右３,0153:スカート右４,<BR>
0134:,0160:スカート右後１,0159:スカート右後２,0158:スカート右後３,0157:スカート右後４,<BR>
0134:,0164:スカート後１,0163:スカート後２,0162:スカート後３,0161:スカート後４,<BR>
0134:,0168:スカート左後１,0167:スカート左後２,0166:スカート左後３,0165:スカート左後４,<BR>
0134:,0172:スカート左１,0171:スカート左２,0170:スカート左３,0169:スカート左４,<BR>
0134:,0176:スカート左前１,0175:スカート左前２,0174:スカート左前３,0173:スカート左前４,<BR>
0134:,0140:左もも,0139:左ひざ,0138:左足,0137:end-左足,<BR>
0134:,0143:右もも,0142:右ひざ,0141:右足,0136:end-右足,<BR>
<BR>
(途中省略)<BR>
<BR>
0121:,0117:end-頭,<BR>
0107:,0106:胸不動１,0105:胸不動２,<BR>
-------------- file のおわり　----------------------<BR>
<BR>
上の結果は、E3DHSPのサンプルに入っている、ni_parts_4_bone.sig の<BR>
ボーン情報を出力したものです。<BR>
一部、省略してあります。<BR>
<BR>
まず、ファイルの先頭に、”BoneFile : type mixed : ver1001”という行があります。<BR>
これは、RokDeBone2が、混合タイプであることを見分けるために、必要な行です。<BR>
改行やスペースを含めて、<B>半角</B>で、正しく記述する必要があります。<BR>
”type” の後に続く、”<B>mixed</B>”という部分に、特に注意してください。<BR>
<BR>
<BR>
行と行の間に、依存関係はありません。<BR>
各行とも、独立した情報になるようにしました。<BR>
<BR>
フォーマットは、次の通りです。<BR>
１，行の先頭には、親のボーンのシリアル番号を書く。（：マークも付ける）<BR>
　　親のボーンがない場合には、”0000:” と書く。<BR>
２，各行には、親,子供,孫, ひ孫, ... の順で要素をカンマで区切って、並べて書く。<BR>
３，各要素は、”シリアル番号：要素名”　の形式で書く。<BR>
４，シリアル番号は、4桁で書く。たとえば１２の場合は、0012 と書く。<BR>
５，シリアル番号、コロン、カンマは、<B>半角で書く</B>。<BR>
<BR>
例えば、<BR>
<B>0134:,0140:左もも,0139:左ひざ,0138:左足,0137:end-左足,</B><BR>
という行について見てみますと、<BR>
<BR>
まず、左ももの親のボーンの番号134を4桁プラス コロン表記で書きます。(0134:）<BR>
次に、134番のボーンの子供として、１４０番の左ももを書きます。<BR>
次に、左ももの子供として、１３９番の左ひざを書きます。<BR>
次に、左ひざの子供として、１３８番の左足をかきます。<BR>
。。。。<BR>
という具合です。<BR>
<BR>
</P>
<P><FONT size="+2"><B>セパレートタイプのフォーマット</B></FONT><BR>
<BR>
セパレートタイプの出力例は、以下のようになります。<BR>
<BR>
----------- file のはじまり　-----------<BR>
BoneFile : type <B>separated</B> : ver1001<BR>
<BR>
<B>NAMEPART_START</B><BR>
0104:右手不動２<BR>
0105:胸不動２<BR>
0106:胸不動１<BR>
0107:胸<BR>
0108:右肩<BR>
0109:右ひじ<BR>
<BR>
（途中省略）<BR>
<BR>
0272:左薬指２<BR>
0273:左薬指１<BR>
0274:左小指３<BR>
0275:左小指２<BR>
0276:左小指１<BR>
<B>NAMEPART_END</B><BR>
<BR>
<BR>
<B>TREEPART_START</B><BR>
<BR>
0103,0135,0134,0148,0147,0146,0145,<BR>
0134,0149,0152,0151,0150,<BR>
0134,0156,0155,0154,0153,<BR>
0134,0160,0159,0158,0157,<BR>
0134,0164,0163,0162,0161,<BR>
0134,0168,0167,0166,0165,<BR>
<BR>
（途中省略）<BR>
<BR>
0121,0119,0118,<BR>
0121,0117,<BR>
0107,0106,0105,<BR>
<B>TREEPART_END</B><BR>
------- file の終わり　---------------<BR>
<BR>
上の結果も、E3DHSPのサンプルに入っている、ni_parts_4_bone.sig の<BR>
ボーン情報を出力したものです。<BR>
一部、省略してあります。<BR>
<BR>
まず、ファイルの先頭に、”BoneFile : type separated : ver1001”という行があります。<BR>
これは、RokDeBone2が、セパレートタイプであることを見分けるために、必要な行です。<BR>
改行やスペースを含めて、<B>半角</B>で、正しく記述する必要があります。<BR>
”type” の後に続く、”<B>separated</B>”という部分に、特に注意してください。<BR>
<BR>
セパレートタイプの場合は、<BR>
シリアル番号対名前の情報と、<BR>
階層構造情報を、分けて記述します。<BR>
<BR>
<B>名前情報、あるいは、階層構造情報のどちらか一方のみ書かれたファイルでも、<BR>
RokDeBone2で入力することが出来ます。</B><BR>
<BR>
<B>名前情報は、NAMEPART_START と　NAMEPART_END で、はさまれた部分</B>に記述します。<BR>
一行に、一個のジョイントの名前の情報を記述します。<BR>
4桁表記のシリアル番号 + 半角のコロン + ジョイントの名前<BR>
の形式で記述します。<BR>
<BR>
たとえば、<BR>
”0104:右手不動２”<BR>
の行は、シリアル番号104のジョイントの名前を、右手不動２という名前にしなさい、という記述です。<BR>
<BR>
<BR>
<B>階層構造情報は、TREEPART_START　と、　TREEPART_END で、はさまれた部分</B>に記述します。<BR>
各行には、親, 子供, 孫, ひ孫, ... の順でシリアル番号をカンマで区切って、並べて記述します。<BR>
シリアル番号は、4桁表記で記述します。（１２の場合は、００１２と書く。）<BR>
<BR>
たとえば、<BR>
” 0121,0119,0118,”<BR>
の行は、シリアル番号１０２のジョイントの子供として、シリアル番号１１９のジョイントを登録し、<BR>
シリアル番号１１９のジョイントの子供として、シリアル番号１１８のジョイントを登録することを意味しています。<BR>
<BR>
<BR>
シリアル番号、コロン、カンマ、NAMEPART_START, NAMEPART_END, TREEPART_START, TREEPART_END, ファイルの先頭行は、<BR>
<B>半角</B>で記述する必要があります。<BR>
<BR>
<BR>
<BR>
<FONT size="+2"><B>相対値モードについて（ver1.0.3.1以降のRokDeBone2）</B></FONT><BR>
<BR>
ver1.0.3.1からは、ボーンファイルに相対値モードが、追加されました。<BR>
相対値モードとは、<B>シリアル番号の部分に、実際の値ではなく、相対値を記述する</B>モードのことです。<BR>
ボーンのシリアル番号の内、一番小さいシリアル番号をfirst_serial、任意のボーンのシリアル番号をcur_serialとすると、<BR>
シリアル番号の部分に、cur_serial - firset_serial の値を記述することになります。<BR>
<BR>
例えば、ボーンの中で、一番小さいシリアル番号が１３であったとすると、<BR>
通常のモードで、シリアル番号１６のボーンの記述は、0016になりますが、<BR>
相対値モードでは、16 - 13 = 3 なので、0003と記述することになります。<BR>
<BR>
このモードの利点は、<BR>
モデルデータ（*.rokや、*.mqo）中に、記述されている、ボーンの出現順番（０から始まり１ずつ増える番号）と、<BR>
相対値が等しいことにあります。<BR>
そのため、他のソフトで作ったデータから、RokDeBone2で使用可能なボーンファイルを作成する際に、<BR>
便利になります。<BR>
<BR>
また、もう一つの利点は、<BR>
相対値モードで、ボーンファイルを保存しておけば、<BR>
形状データ部分だけ、データが更新された場合に、<BR>
保存しておいたボーンファイルを、そのまま、読み込むことで、<BR>
ボーン構造を復元できる点です。<BR>
（ボーン構造などが変化した場合は、ボーンファイルも編集し直さないといけません。）<BR>
<BR>
相対値なので、マイナスの値もサポートすることになりました。<BR>
<B>マイナスの場合は、半角の-符号の後に、４桁の番号</B>を記述します。<BR>
例えば、一番親のボーンの親の番号を指定する際には、<BR>
-0001 と書くことになると思います。<BR>
<BR>
相対値モードのボーンファイルを、手で編集する場合は、<BR>
ボーンファイルが相対値モードであることを宣言しなければなりません。<BR>
これは、ボーンファイル中に、<BR>
<B>RELATIVE_BONENO_MODE</B><BR>
という行を書けばＯＫです。<BR>
行と書いたのは、改行マークも含まれていないといけないことを意味します。<BR>
<BR>
<BR>
RokDeBone2から、相対値モードのボーンファイルを作る場合は、<BR>
fileメニューの、「ボーン情報のテキスト出力」を選んでください。<BR>
ファイル名を指定した後、下の図のような、ダイアログが出てきます。<BR>
<BR>
<IMG src="jpegfiles/rdb2_bfwrite.jpg" width="404" height="252" border="0"><BR>
<BR>
ダイアログの、「シリアル番号を相対値で記録する」チェックボックスをチェックすると、<BR>
相対値モードのボーンファイルが作成されます。<BR>
<BR>
<BR>
<BR>
<BR>
<A href="rokdebone.htm">RokDeBone2のダウンロードのページへ</A></P>
<P><A href="index.htm">トップページに戻る</A><BR>
</P>
</BODY>
</HTML>