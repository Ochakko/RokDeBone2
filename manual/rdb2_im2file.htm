<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=SHIFT_JIS">
<META name="GENERATOR" content="IBM WebSphere Studio Homepage Builder Version 9.0.0.0 for Windows">
<META http-equiv="Content-Style-Type" content="text/css">
<TITLE></TITLE>
</HEAD>
<BODY>
<P><FONT size="+2"><B>”影響マップファイル2”　ver1.0.0.1<BR>
</B></FONT></P>
<P><BR>
<A href="#about_im2">１，影響マップファイルとは</A><BR>
<A href="#format_im2">２，フォーマット</A><BR>
<A href="#setting_im2">３，ボーン番号の設定方法について</A><BR>
<BR>
<BR>
/////////////////////<BR>
<A name="about_im2">１，影響マップファイルとは</A><BR>
/////////////////////<BR>
<BR>
影響マップファイル2は、各頂点が、どのボーンから、どのように影響を受けるかを<BR>
保存、編集するファイルです。<BR>
<B>拡張子はim2</B>です。<BR>
<BR>
</P>
<P>//////////////<BR>
<A name="format_im2">２，フォーマット</A><BR>
//////////////</P>
<P>
ver1.0.0.1では、なるべく簡略化し、<BR>
影響するボーンの番号と、計算方法の指定をするだけで、<BR>
良い仕様にしました。<BR>
<BR>
将来のバージョンで、ボーンの影響度を、そのまま記述する方法も、取り入れるかもしれません。<BR>
<BR>
<BR>
ファイルの内容は、以下のようです。<BR>
<BR>
////////////// ファイルの始まり<BR>
<BR>
InfluenceMapFile2 : ver1001<BR>
<BR>
PARTSTART<BR>
パートの名前1<BR>
頂点の番号1, ボーン番号（子供）, ボーン番号（親）, 計算方法<BR>
頂点の番号2, ボーン番号（子供）, ボーン番号（親）, 計算方法<BR>
頂点の番号3, ボーン番号（子供）, ボーン番号（親）, 計算方法<BR>
<BR>
PARTEND<BR>
<BR>
PARTSTART<BR>
パートの名前2<BR>
頂点の番号1, ボーン番号（子供）, ボーン番号（親）, 計算方法<BR>
頂点の番号2, ボーン番号（子供）, ボーン番号（親）, 計算方法<BR>
<BR>
PARTEND<BR>
<BR>
////////////// ファイルの終わり<BR>
<BR>
ファイルの内容の説明をします。<BR>
<BR>
まず、１行目の、&quot;InfluenceMapFile2 : ver1001&quot;は、ファイルのヘッダーです。<BR>
<BR>
<BR>
&quot;PARTSTART&quot;と&quot;PARTEND&quot;の行で、はさまれた行中に、<BR>
各パーツの頂点の情報を記述します。<BR>
　　　　パートの名前<BR>
の部分には、パートの名前を書きます。<BR>
<U>同じ名前が、複数あると、正しく処理されませんので、注意してください。</U><BR>
<BR>
次に、パートに含まれる頂点の情報を書きます。<BR>
　　　　頂点の番号, ボーン番号（子供）, ボーン番号（親）, 計算方法<BR>
の形式で記述します。<BR>
<BR>
<B>頂点の番号には、sigの元データであるmqoファイルやrokファイル内での頂点の番号を記述します。</B><BR>
元データがmqoファイルである場合には、<BR>
mqoファイルにおける、パーツ内での頂点の出現順番（０から始まる番号）と一致させてください。<BR>
元データがrokファイルである場合には、<BR>
rokファイルにおける、頂点記述パート内に記述されている頂点のインデックス（１から始まる番号）を記述してください。<BR>
<U><BR>
頂点の番号に、-1を記述した場合は、パーツ内の全ての頂点に、適用されます。</U><BR>
<BR>
<BR>
ボーン番号（子供）, ボーン番号（親）の部分で、頂点に影響を与える<U>ボーンのベクトルを一つだけ</U>指定します。<BR>
番号は、<U>相対値モードのボーンファイルの値と一致する番号</U>を、記述してください。<BR>
これら２つの番号は、必ず、親子関係にあるボーンの番号を、子供、親の順番で記述してください。<BR>
親が存在しない場合には、-1と記述してください。<BR>
<U>子供のボーン番号に-1を指定すると、エラーになります。</U><BR>
<BR>
<B>計算方法に、ワンスキンを指定する場合は、</B><BR>
<B>頂点の変換計算時に、ここで指定したボーンの、親のボーンを求めて、<BR>
ここで指定したボーンと、その親ボーンとで、ブレンド計算をします。</B><BR>
<BR>
<B>計算方法に、カクカク曲げを指定する場合は、<BR>
ブレンド計算は、行われません。<BR>
</B><BR>
ボーン番号の設定方法の例は、このページの下の方の、”ボーン番号の設定方法について”を、ご覧ください。<BR>
<BR>
<BR>
計算方法の部分には、どのような変形を行うかを指定します。<BR>
　　　　CALC_ONESKIN0<BR>
と書いた場合は、ワンスキンの変形を、主に頂点とボーンの距離情報を元に、行います。<BR>
　　　　CALC_NOSKIN0<BR>
と書いた場合は、ワンスキンの変形をせず、ロボットのように、カクカクと曲げるように変形します。<BR>
<BR>
<BR>
ver1001では、この２種類しか方法を有効にしないつもりですが、<BR>
将来、CALC_ONESKIN1, CALC_ONESKIN2など、色々な計算方法を用意したいとも思っています。<BR>
例えば、人間の関節っぽく曲げる方法と、もっとクネクネ曲げる方法など、<BR>
複数の曲げ方を指定できるようにしたいと思っています。<BR>
<BR>
<BR>
<BR>
<BR>
<BR>
///////////////////////////////<BR>
<A name="setting_im2">３，ボーン番号の設定方法について</A><BR>
///////////////////////////////<BR>
<BR>
<BR>
ここでは、ファイル中の<BR>
　　　　ボーン番号（子供）, ボーン番号（親）<BR>
の部分に記述するボーンを、どのように選べばいいかを、説明します。<BR>
<BR>
絶対に、この通りにしなくてはいけない、と言うのではなくて、<BR>
一つの簡単な例として、読んでください。<BR>
<BR>
<B>ワンスキン処理の場合</B><BR>
<BR>
１，　まず、任意の頂点に影響を与えるボーンツリーを求めます。<BR>
　　ボーンの影響範囲などを考慮して、ボーンツリーを決定してください。<BR>
<BR>
２，　１で、求めたボーンツリーの中で、頂点から一番近いジョイントを求めます。<BR>
　　ここで、求めるジョイントは、子供ジョイントを持っていることを条件として、探します。<BR>
　　ここで、求めたジョイントの番号を、 ”ボーン番号（親）”　の部分に記述します。<BR>
<BR>
３，　２で求めた親ジョイントの全ての子供ジョイントと、頂点との距離を比較し、<BR>
　　一番近い距離にあるジョイントを探します。<BR>
　　ここで、求めたジョイントの番号を”ボーン番号（子供）”　の部分に記述します。<BR>
<BR>
と、このように、影響範囲と、距離、親子関係だけの情報から作ったデータで、ほとんどの場合、ＯＫです。<BR>
</P>
<P><BR>
<BR>
</P>
<P><BR>
<BR>
<A href="index.htm">トップページに戻る</A></P>
</BODY>
</HTML>